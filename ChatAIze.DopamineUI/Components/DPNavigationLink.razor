@implements ITaggable
@inject NavigationManager NavigationManager

<button class="group/navlink @ButtonClass @WidthClass" ontouchstart="" @onclick="NavigateToPath">
    <CascadingValue Value="Context"> @ChildContent</CascadingValue>
</button>

@code {
    /// <summary>
    /// Gets or sets the navigation path to navigate to.
    /// </summary>
    [Parameter]
    public string? Path { get; set; }

    /// <summary>
    /// Gets or sets the content displayed for the navigation link.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets whether the link should stretch to full width.
    /// </summary>
    [Parameter]
    public bool IsFullWidth { get; set; }

    /// <summary>
    /// Gets or sets a value indicating whether the link is disabled.
    /// </summary>
    [Parameter]
    public bool IsDisabled { get; set; }

    /// <summary>
    /// Gets or sets user data associated with the component.
    /// </summary>
    [Parameter]
    public object? Tag { get; set; }

    [CascadingParameter]
    private UIContext ParentContext { get; set; } = new();

    private UIContext Context => ParentContext with { IsDisabled = ParentContext.IsDisabled || IsDisabled };

    private string ButtonClass => Context.IsDisabled ? "dp-navigation-link-disabled" : "dp-navigation-link";

    private string WidthClass
    {
        get
        {
            if (IsFullWidth == true)
            {
                return "w-full min-w-fit";
            }

            if (IsFullWidth == false)
            {
                return "w-fit";
            }

            return "w-full sm:w-fit min-w-fit";
        }
    }

    private void NavigateToPath()
    {
        if (!Context.IsDisabled && !string.IsNullOrWhiteSpace(Path))
        {
            Context.NavigationView?.Close();
            NavigationManager.NavigateTo(Path);
        }
    }
}
